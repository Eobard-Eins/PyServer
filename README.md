# python服务类开发文档

> ## 2024/1/29
>- **记录**：图数据库尽可能的少记录信息，比如task具体内容不存储，其应存于mysql中，返回spring推荐id列表，spring按列表查找信息

> ## 2024/2/1
>- **记录**：使用TFIDF不太行，关键词提取不够准，词向量方案基本不行了。
>- **更正**：用Tag，用户对不同tag有不同偏好权重，每个task对tag有不同权重，[基于标签的反向倒排索引做推荐](https://blog.csdn.net/LJY1806192339/article/details/124582942?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170618978616800180657715%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=170618978616800180657715&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-124582942-null-null.142^v99^pc_search_result_base7&utm_term=%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%20%E5%9F%BA%E4%BA%8E%E5%9B%BE&spm=1018.2226.3001.4187)，其中，用户对tag的权重由其行为更正；对于多个类似tag不互通的问题，使用关键词提取不好解决，因为可能造成tag意思的偏移，但是可以将英文单词全部`转换为小写`，保证大小写造成不同tag。在前端输入tag时，可以推荐包含已输入词的tag供其选择，以减少同意不同词的发生。直接1用图数据库算会快一些。

> ## 2024/2/2
>- **记录**：对于距离、报酬等可量化因素，直接以某个值对初步推荐结果进行截断不太合适，拟采用正态分布概率筛选初次推荐结果进行推荐，正太分布的中值应为用户画像中的理想值。
>- **记录**：对于Task与Tag之间的Own关系的value值得设置，使用`IDF`作为其值（即tag对于task的权重），以试图减少噪声影响。但是使用该结构精准度不算高但能用。
>>- 关于`TF`：由于TF本质上讲是区分不同tag用的，词频越高TD-IDF越高，但是在本项目中tag没有词频那样的具有某种特征差异，大体可以看作词频一致，故而直接使用IDF值可看作是TF值为1的特例
>- **记录**：不设置idf的影响：在user访问task的过程中，若某一tag在大多数task中出现，那么user对于这个tag的偏好值会逐渐增大且值与增长速度大于其他偏好值，即user更为偏好这个tag，使得对于一个task的推荐值来说其贡献更大，其他tag的贡献较小，且因大部分task均存在该tag导致其区分度不大，换言之这个tag会减弱更能代表这个task的tag的影响，减小区分度。

> ## 2024/2/8
>- **记录**：新task添加tag时用近似idf暂且替代value，及未考虑该task影响的idf值
>- **记录**：添加task，5个tag用时66ms，2个用时38ms。
>- **记录**：更新idf(1000 tag)
>> | task数 | 用时 |
>> | --- | --- |
>> | 1000 | 1.6s~3.8S |
>> | 10000 | 2.2s~3.1s |
>> | 100000 | 3.2s~5.3s，优化后最低记录为1.8s |
>- **记录**：生成推荐(1000 tag)
>> | task数 | 用时 |
>> | --- | --- |
>> | 1000 | 0.2s |
>> | 100000 | 0.46-0.506s |
>- **记录**：推荐效果测试：
>>- 测试方案：首先获取推荐列表和用户画像（用户最偏好的5个tag），再创建tag为上述5个tag的task，再次获取推荐
>>- 测试结果：百次测试中均位于前3位，其中位于第一推荐`85`次，占比`85%`。
>>- 结论：新增task成为推荐度较高的task，`可以`说明对于用户的不同偏好可以做出个性化推荐
>>- 具体记录(以手动测试为例)：
>>>- 第1次：\
`{'taskId': 'task-test', 'value': 138.76280734548357}
{'taskId': 'task12528', 'value': 104.70875030771256}
{'taskId': 'task79541', 'value': 99.56879709394094}
{'taskId': 'task11201', 'value': 94.75192948533869}
{'taskId': 'task79601', 'value': 94.7462849149843}
{'taskId': 'task99965', 'value': 88.87064364108598}
{'taskId': 'task32989', 'value': 87.64534208267244}
{'taskId': 'task24534', 'value': 85.15716091989859}
{'taskId': 'task71465', 'value': 84.51441276074912}
{'taskId': 'task99868', 'value': 83.90888411785676}
{'taskId': 'task99790', 'value': 83.50782205780338}
{'taskId': 'task30853', 'value': 83.00130633463208}`

>>>- 第2次：\
`{'taskId': 'task99797', 'value': 149.5949456384592}
{'taskId': 'task-test1', 'value': 142.27179217492798}
{'taskId': 'task99980', 'value': 127.31897208379021}
{'taskId': 'task99782', 'value': 107.89286833096865}
{'taskId': 'task99822', 'value': 103.74011865500776}
{'taskId': 'task99839', 'value': 98.95859574466354}
{'taskId': 'task39908', 'value': 98.31512900037242}
{'taskId': 'task76876', 'value': 92.20174532597642}
{'taskId': 'task64720', 'value': 88.25438364970626}
{'taskId': 'task11305', 'value': 87.91818149127764}
{'taskId': 'task99786', 'value': 87.8053132975979}
{'taskId': 'task67323', 'value': 86.53634858319346}`

>>>- 第3次：\
`{'taskId': 'task-test2', 'value': 143.11288352081357}
{'taskId': 'task99918', 'value': 142.869743812815}
{'taskId': 'task99843', 'value': 131.63251376365318}
{'taskId': 'task99789', 'value': 112.09109306484274}
{'taskId': 'task82485', 'value': 105.93424978964448}
{'taskId': 'task99833', 'value': 105.20918591488739}
{'taskId': 'task50053', 'value': 100.52028933800713}
{'taskId': 'task99787', 'value': 99.62828061815328}
{'taskId': 'task30519', 'value': 99.3485683202125}
{'taskId': 'task82740', 'value': 99.0086558602329}
{'taskId': 'task99783', 'value': 98.17764865997341}
{'taskId': 'task99882', 'value': 97.12072869874252}`

> ## 2024/2/12
>- **记录**：用户操作中的点击操作在退出详情页且无其余操再执行，避免削弱不喜欢的影响和增大其余操作影响

> ## 2024/2/13
>- **记录**：距离因素在neo4j中直接计算比较困难，计划在spring端筛出超出一定距离的推荐，最后将推荐列表返回python进行标记，point因素不考虑
